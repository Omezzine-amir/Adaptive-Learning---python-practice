
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Python Basics Practice (20 min)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; }

    :root {
      /* Primary palette - friendly blue-purple gradient feel */
      --primary: #6C63FF;
      --primary-hover: #5A52E0;
      --primary-light: #EDEDFF;
      --primary-bg: #F0EEFF;

      /* Accent colors */
      --accent-green: #22C55E;
      --accent-green-light: #DCFCE7;
      --accent-green-dark: #16A34A;
      --accent-red: #EF4444;
      --accent-red-light: #FEE2E2;
      --accent-orange: #F59E0B;
      --accent-orange-light: #FEF3C7;

      /* Neutrals */
      --bg: #F8F7FF;
      --bg-card: #FFFFFF;
      --text: #1E1B4B;
      --text-secondary: #4B5563;
      --text-muted: #6B7280;
      --border: #E5E7EB;
      --border-light: #F3F4F6;

      /* Shadows */
      --shadow-sm: 0 1px 3px rgba(108, 99, 255, 0.08);
      --shadow-md: 0 4px 12px rgba(108, 99, 255, 0.1);
      --shadow-lg: 0 8px 24px rgba(108, 99, 255, 0.12);

      /* Radii */
      --radius: 12px;
      --radius-lg: 16px;
      --radius-sm: 8px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* Header */
    header {
      background: linear-gradient(135deg, #6C63FF 0%, #8B83FF 50%, #A78BFA 100%);
      color: white;
      padding: 24px 28px;
      position: relative;
      overflow: hidden;
    }
    header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -10%;
      width: 300px;
      height: 300px;
      background: rgba(255,255,255,0.08);
      border-radius: 50%;
    }
    header::after {
      content: '';
      position: absolute;
      bottom: -30%;
      left: 20%;
      width: 200px;
      height: 200px;
      background: rgba(255,255,255,0.05);
      border-radius: 50%;
    }
    header h1 {
      margin: 0 0 8px;
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -0.3px;
      position: relative;
      z-index: 1;
    }
    header h1 .header-icon {
      margin-right: 8px;
      font-size: 24px;
    }
    header p {
      margin: 0;
      font-size: 14px;
      color: rgba(255,255,255,0.9);
      position: relative;
      z-index: 1;
      line-height: 1.5;
    }

    /* Main layout */
    .wrap {
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 20px;
      padding: 20px 28px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: var(--shadow-sm);
      transition: box-shadow 0.2s ease;
    }
    .card:hover {
      box-shadow: var(--shadow-md);
    }

    /* Typography */
    .muted { color: var(--text-muted); font-size: 13px; font-weight: 500; }
    .tiny { font-size: 13px; color: var(--text-secondary); line-height: 1.7; }

    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

    /* Form controls */
    select, button, input[type="text"] {
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      padding: 9px 14px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: var(--bg-card);
      color: var(--text);
      transition: all 0.2s ease;
    }
    select {
      width: 100%;
      cursor: pointer;
      font-weight: 500;
      padding: 10px 14px;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236B7280' viewBox='0 0 16 16'%3E%3Cpath d='M4.646 6.646a.5.5 0 0 1 .708 0L8 9.293l2.646-2.647a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }

    /* Buttons */
    button {
      cursor: pointer;
      font-weight: 600;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    button:active {
      transform: scale(0.97);
    }
    button.primary {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
      padding: 10px 20px;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(108, 99, 255, 0.3);
    }
    button.primary:hover:not(:disabled) {
      background: var(--primary-hover);
      box-shadow: 0 4px 12px rgba(108, 99, 255, 0.4);
      transform: translateY(-1px);
    }
    button.ghost {
      background: var(--bg-card);
      color: var(--primary);
      border: 1.5px solid var(--primary);
    }
    button.ghost:hover:not(:disabled) {
      background: var(--primary-light);
    }
    button.success {
      background: var(--accent-green);
      color: #fff;
      border-color: var(--accent-green);
      padding: 10px 20px;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
    }
    button.success:hover:not(:disabled) {
      background: var(--accent-green-dark);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
      transform: translateY(-1px);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Code editor */
    textarea {
      width: 100%;
      min-height: 320px;
      font-family: 'Fira Code', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 14px;
      line-height: 1.6;
      padding: 16px;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      resize: vertical;
      background: #FAFAFA;
      color: var(--text);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      tab-size: 4;
    }
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
      background: #fff;
    }

    /* Output area */
    pre {
      background: #1E1B4B;
      color: #E2E8F0;
      padding: 16px;
      border-radius: var(--radius);
      overflow: auto;
      min-height: 120px;
      margin: 12px 0 0;
      font-family: 'Fira Code', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 13px;
      line-height: 1.5;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Details/Summary (accordions) */
    details {
      margin-top: 16px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all 0.2s ease;
    }
    details[open] {
      border-color: var(--border);
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      padding: 14px 16px;
      background: var(--border-light);
      color: var(--text);
      transition: background 0.2s ease;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    details summary::-webkit-details-marker { display: none; }
    details summary::before {
      content: '';
      display: inline-block;
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 5px 0 5px 8px;
      border-color: transparent transparent transparent var(--primary);
      transition: transform 0.2s ease;
      flex-shrink: 0;
    }
    details[open] summary::before {
      transform: rotate(90deg);
    }
    details summary:hover {
      background: #ECEAFF;
    }
    details > div, details > .tiny {
      padding: 16px;
    }

    /* Pills / Badges */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 12px;
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      background: var(--bg);
      transition: all 0.2s ease;
    }
    .pill.active {
      background: var(--primary-light);
      border-color: var(--primary);
      color: var(--primary);
    }

    /* Status indicators */
    .ok { color: var(--accent-green-dark); font-weight: 700; }
    .bad { color: var(--accent-red); font-weight: 700; }
    .statusline { margin-top: 8px; font-size: 13px; }

    /* KPI row */
    .kpi { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .kpi .pill { background: var(--primary-light); border-color: rgba(108, 99, 255, 0.2); color: var(--primary); font-weight: 600; }

    /* Section labels */
    .section-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--primary);
      margin-bottom: 6px;
    }

    /* Mini-lesson content */
    .lesson-content p {
      margin: 0;
      padding: 10px 14px;
      border-radius: var(--radius-sm);
      border-left: 3px solid transparent;
      transition: background 0.2s ease;
    }
    .lesson-content p:hover {
      background: var(--primary-bg);
    }
    .lesson-content p b {
      color: var(--primary);
    }
    .lesson-content p code {
      background: var(--primary-light);
      color: var(--primary-hover);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      font-weight: 500;
    }
    .lesson-tip {
      background: var(--accent-orange-light);
      border: 1px solid #FDE68A;
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      margin-top: 8px;
      font-size: 13px;
      color: #92400E;
    }
    .lesson-tip b { color: #92400E; }

    /* Exercise goal */
    .exercise-goal {
      background: var(--primary-bg);
      border: 1px solid rgba(108, 99, 255, 0.15);
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      margin-top: 10px;
      font-size: 13px;
      color: var(--text);
      font-weight: 500;
    }

    /* MCQ styling */
    .mcq-question {
      padding: 14px;
      border-radius: var(--radius-sm);
      background: #FAFAFA;
      margin-bottom: 12px;
      border: 1px solid var(--border-light);
      transition: all 0.2s ease;
    }
    .mcq-question:hover {
      border-color: var(--border);
      box-shadow: var(--shadow-sm);
    }
    .mcq-question p {
      margin: 0 0 10px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }
    .mcq-question p code {
      background: var(--primary-light);
      color: var(--primary-hover);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      font-size: 12px;
    }
    .mcq-question label {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      margin: 4px 0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-secondary);
      transition: background 0.15s ease;
      border: 1px solid transparent;
    }
    .mcq-question label:hover {
      background: var(--primary-light);
      border-color: rgba(108, 99, 255, 0.15);
    }
    .mcq-question input[type="radio"] {
      width: 16px;
      height: 16px;
      accent-color: var(--primary);
      flex-shrink: 0;
    }
    .mcq-feedback {
      margin-top: 8px;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 13px;
      line-height: 1.5;
    }
    .mcq-score {
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      background: var(--primary-light);
      border: 1px solid rgba(108, 99, 255, 0.2);
      font-weight: 600;
      font-size: 14px;
      color: var(--primary);
    }

    /* Help tip at bottom */
    .help-tip {
      background: #F0FDF4;
      border: 1px solid #BBF7D0;
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      margin-top: 12px;
      font-size: 13px;
      color: #166534;
      line-height: 1.5;
    }

    /* Code editor section header */
    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }
    .editor-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
    }

    /* Output section header */
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 14px;
    }
    .output-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Not graded notice */
    .notice {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #EFF6FF;
      border: 1px solid #BFDBFE;
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      margin-top: 12px;
      font-size: 13px;
      color: #1E40AF;
    }
    .notice-icon {
      font-size: 16px;
      flex-shrink: 0;
    }

    /* Responsive */
    @media (max-width: 980px) {
      .wrap { grid-template-columns: 1fr; padding: 16px; }
      header { padding: 20px 16px; }
      header h1 { font-size: 18px; }
    }

    /* Loading animation for status pill */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .loading { animation: pulse 1.5s ease-in-out infinite; }

    /* Fade-in for sections */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .card {
      animation: fadeIn 0.4s ease forwards;
    }
    .card:nth-child(2) {
      animation-delay: 0.1s;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      font-size: 12px;
      color: var(--text-muted);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
</head>

<body>
<header>
  <h1><span class="header-icon">&#127919;</span> Python Foundations 1: Basics Practice</h1>
  <p>Read the mini-lesson, then complete short coding tasks. Use <span style="background:rgba(255,255,255,0.2);padding:2px 10px;border-radius:6px;font-weight:600;">Run</span> to execute code and <span style="background:rgba(255,255,255,0.2);padding:2px 10px;border-radius:6px;font-weight:600;">Check</span> to validate your answer. Takes about 20 minutes.</p>
</header>

<div class="wrap">
  <!-- LEFT: lesson + exercise list -->
  <section class="card">
    <div class="row" style="justify-content: space-between;">
      <div>
        <div class="section-label">Environment</div>
        <div id="pyStatus" class="statusline"><span class="pill loading">&#9881; Loading Python...</span></div>
      </div>
      <div class="kpi">
        <span class="pill" id="kpiExercise">&#128218; Exercise: 1/6</span>
        <span class="pill" id="kpiScore">&#10003; Passed: 0</span>
      </div>
    </div>

    <details open>
      <summary>Mini-lesson (read in ~10 minutes)</summary>
      <div class="lesson-content" style="margin-top:0;">
        <p><b>1. Printing</b><br/>Use <code>print()</code> to show output on the screen.</p>
        <p><b>2. Variables &amp; Arithmetic</b><br/>Assign with <code>=</code>. Example: <code>x = 3</code>. Do math: <code>x + 5</code>.</p>
        <p><b>3. Strings</b><br/>Text goes in quotes: <code>"hello"</code>. Join strings with <code>+</code>.</p>
        <p><b>4. If Statements</b><br/>
          <code>if condition:</code> then indented code runs. Add <code>else:</code> for alternatives.
        </p>
        <p><b>5. Loops</b><br/>
          <code>for i in range(5):</code> repeats 5 times (0 to 4).
        </p>
        <p><b>6. Functions</b><br/>
          Define reusable logic: <code>def add(a, b): return a + b</code>
        </p>
        <div class="lesson-tip"><b>Tip:</b> Python cares about indentation. Use 4 spaces to indent code blocks.</div>
      </div>
    </details>

    <details open>
      <summary>Choose exercise</summary>
      <div>
        <div class="section-label">Select an exercise</div>
        <select id="exerciseSelect"></select>
        <div class="exercise-goal" id="exerciseGoal"></div>
        <div class="row" style="margin-top:12px;">
          <button class="ghost" id="btnLoad">&#128196; Load starter code</button>
          <button class="ghost" id="btnReveal">&#128161; Reveal solution</button>
        </div>
        <div class="notice">
          <span class="notice-icon">&#8505;</span>
          This practice page is for learning. It is not graded.
        </div>
      </div>
    </details>

    <details>
      <summary>Optional: Quick self-check (multiple choice)</summary>
      <div style="padding-top:8px;">
        <div class="mcq-question">
          <p><b>Q1.</b> What does <code>print("hello")</code> do?</p>
          <label><input type="radio" name="q1" value="a"> Stores "hello" in a variable</label>
          <label><input type="radio" name="q1" value="b"> Displays hello in the output</label>
          <label><input type="radio" name="q1" value="c"> Creates a file called hello</label>
          <div id="mcqResult1" class="mcq-feedback"></div>
        </div>

        <div class="mcq-question">
          <p><b>Q2.</b> After running <code>x = 10</code>, what is the value of <code>x + 3</code>?</p>
          <label><input type="radio" name="q2" value="a"> 10</label>
          <label><input type="radio" name="q2" value="b"> 3</label>
          <label><input type="radio" name="q2" value="c"> 13</label>
          <div id="mcqResult2" class="mcq-feedback"></div>
        </div>

        <div class="mcq-question">
          <p><b>Q3.</b> What does <code>"Hello" + " " + "World"</code> produce?</p>
          <label><input type="radio" name="q3" value="a"> HelloWorld</label>
          <label><input type="radio" name="q3" value="b"> Hello World</label>
          <label><input type="radio" name="q3" value="c"> An error</label>
          <div id="mcqResult3" class="mcq-feedback"></div>
        </div>

        <div class="mcq-question">
          <p><b>Q4.</b> What prints when this code runs?<br/><code>x = 3<br/>if x &gt; 5:<br/>&nbsp;&nbsp;&nbsp;&nbsp;print("big")<br/>else:<br/>&nbsp;&nbsp;&nbsp;&nbsp;print("small")</code></p>
          <label><input type="radio" name="q4" value="a"> big</label>
          <label><input type="radio" name="q4" value="b"> small</label>
          <label><input type="radio" name="q4" value="c"> Nothing is printed</label>
          <div id="mcqResult4" class="mcq-feedback"></div>
        </div>

        <div class="mcq-question">
          <p><b>Q5.</b> What does <code>range(3)</code> produce in a loop?</p>
          <label><input type="radio" name="q5" value="a"> 1, 2, 3</label>
          <label><input type="radio" name="q5" value="b"> 0, 1, 2</label>
          <label><input type="radio" name="q5" value="c"> 0, 1, 2, 3</label>
          <div id="mcqResult5" class="mcq-feedback"></div>
        </div>

        <div class="mcq-question">
          <p><b>Q6.</b> What does the following function return when called as <code>double(4)</code>?<br/><code>def double(n):<br/>&nbsp;&nbsp;&nbsp;&nbsp;return n * 2</code></p>
          <label><input type="radio" name="q6" value="a"> 4</label>
          <label><input type="radio" name="q6" value="b"> 8</label>
          <label><input type="radio" name="q6" value="c"> 42</label>
          <div id="mcqResult6" class="mcq-feedback"></div>
        </div>

        <button class="success" id="btnMCQ" style="margin-top:8px; width:100%;">&#10003; Check answers</button>
        <div id="mcqResult" class="mcq-score" style="display:none;"></div>
      </div>
    </details>
  </section>

  <!-- RIGHT: editor + run/check -->
  <section class="card">
    <div class="editor-header">
      <div>
        <div class="section-label">Code editor</div>
        <div class="editor-title" id="exerciseTitle"></div>
      </div>
      <div class="row">
        <button id="btnRun" class="primary" disabled>&#9654; Run</button>
        <button id="btnCheck" class="success" disabled>&#10003; Check</button>
        <button id="btnReset" class="ghost" disabled>&#8634; Reset</button>
      </div>
    </div>

    <textarea id="codeArea" spellcheck="false" placeholder="Your Python code goes here..."></textarea>

    <div class="output-header">
      <div class="output-label">&#128187; Output</div>
      <div id="checkResult" style="font-size:13px;"></div>
    </div>
    <pre id="outputArea">Loading...</pre>

    <div class="help-tip">
      <b>Stuck?</b> If you see an error, read the last line first. Most beginner errors are missing quotes, missing colons, or wrong indentation.
    </div>
  </section>
</div>

<footer>
  Python Basics Practice &mdash; Built for learners
</footer>

<script>
  // -----------------------------
  // Exercises (20-min set)
  // -----------------------------
  const EXERCISES = [
    {
      id: "ex1",
      title: "Exercise 1: Print a welcome line",
      goal: "Goal: Print exactly: Hello, Python!",
      starter: `# Print exactly: Hello, Python!\n\n`,
      solution: `print("Hello, Python!")\n`,
      testPy: `
expected = "Hello, Python!\\n"
passed = (stdout == expected)
msg = "Expected exactly: Hello, Python!"`,
    },
    {
      id: "ex2",
      title: "Exercise 2: Variables and arithmetic",
      goal: "Goal: Create two variables a=7 and b=5, then print their sum (12).",
      starter: `# Create a=7, b=5, then print a+b\n\n`,
      solution: `a = 7\nb = 5\nprint(a + b)\n`,
      testPy: `
expected = "12\\n"
passed = (stdout == expected)
msg = "Expected output: 12"`,
    },
    {
      id: "ex3",
      title: "Exercise 3: Strings",
      goal: "Goal: Create name = \"Amir\" then print: Welcome Amir",
      starter: `# Create name = "Amir"\n# Then print: Welcome Amir\n\n`,
      solution: `name = "Amir"\nprint("Welcome " + name)\n`,
      testPy: `
expected = "Welcome Amir\\n"
passed = (stdout == expected)
msg = "Expected output: Welcome Amir"`,
    },
    {
      id: "ex4",
      title: "Exercise 4: If statement",
      goal: "Goal: If score >= 60 print PASS else print FAIL. Use score = 75.",
      starter: `# Use score = 75\n# If score >= 60 print PASS else print FAIL\n\nscore = 75\n`,
      solution: `score = 75\nif score >= 60:\n    print("PASS")\nelse:\n    print("FAIL")\n`,
      testPy: `
expected = "PASS\\n"
passed = (stdout == expected)
msg = "Expected output: PASS"`,
    },
    {
      id: "ex5",
      title: "Exercise 5: For loop",
      goal: "Goal: Print numbers 1 to 5, each on its own line.",
      starter: `# Print 1,2,3,4,5 each on a new line\n\n`,
      solution: `for i in range(1, 6):\n    print(i)\n`,
      testPy: `
expected = "1\\n2\\n3\\n4\\n5\\n"
passed = (stdout == expected)
msg = "Expected five lines: 1 through 5"`,
    },
    {
      id: "ex6",
      title: "Exercise 6: Function",
      goal: "Goal: Write a function add(a,b) that returns a+b, then print add(3,4).",
      starter: `# Define add(a,b) that returns a+b\n# Then print add(3,4)\n\n`,
      solution: `def add(a, b):\n    return a + b\n\nprint(add(3, 4))\n`,
      testPy: `
expected = "7\\n"
passed = (stdout == expected)
msg = "Expected output: 7"`,
    },
  ];

  let pyodide = null;
  let currentIdx = 0;
  let passedChecks = 0;

  const el = (id) => document.getElementById(id);

  function setStatus(html) { el("pyStatus").innerHTML = html; }
  function setOutput(text) { el("outputArea").textContent = text; }
  function setCheck(text, ok=null) {
    if (ok === true) el("checkResult").innerHTML = `<span class="ok">${text}</span>`;
    else if (ok === false) el("checkResult").innerHTML = `<span class="bad">${text}</span>`;
    else el("checkResult").textContent = text;
  }

  function populateExercises() {
    const sel = el("exerciseSelect");
    sel.innerHTML = "";
    EXERCISES.forEach((ex, i) => {
      const opt = document.createElement("option");
      opt.value = String(i);
      opt.textContent = `${i+1}. ${ex.title.replace("Exercise " + (i+1) + ": ", "")}`;
      sel.appendChild(opt);
    });
  }

  function loadExercise(idx, fromReset=false) {
    currentIdx = idx;
    const ex = EXERCISES[idx];
    el("exerciseSelect").value = String(idx);
    el("exerciseTitle").textContent = ex.title;
    el("exerciseGoal").textContent = ex.goal;
    el("kpiExercise").textContent = `\u{1F4DA} Exercise: ${idx+1}/${EXERCISES.length}`;
    if (!fromReset) {
      el("codeArea").value = ex.starter;
      setOutput("");
      setCheck("");
    }
  }

  function resetToStarter() {
    const ex = EXERCISES[currentIdx];
    el("codeArea").value = ex.starter;
    setOutput("");
    setCheck("");
  }

  function revealSolution() {
    const ex = EXERCISES[currentIdx];
    el("codeArea").value = ex.solution;
  }

  async function runUserCode(code) {
    // Runs code and captures stdout + traceback. Returns {stdout, stderr}
    const wrapper = `
import sys, io, traceback
_user_stdout = io.StringIO()
_user_stderr = io.StringIO()
_old_out, _old_err = sys.stdout, sys.stderr
sys.stdout, sys.stderr = _user_stdout, _user_stderr
_ns = {}
try:
    exec(user_code, _ns, _ns)
except Exception:
    traceback.print_exc()
finally:
    sys.stdout, sys.stderr = _old_out, _old_err
stdout = _user_stdout.getvalue()
stderr = _user_stderr.getvalue()
`;
    pyodide.globals.set("user_code", code);
    await pyodide.runPythonAsync(wrapper);
    const stdout = pyodide.globals.get("stdout");
    const stderr = pyodide.globals.get("stderr");
    return { stdout, stderr };
  }

  async function runButton() {
    setCheck("");
    setOutput("Running...");
    const code = el("codeArea").value;
    const { stdout, stderr } = await runUserCode(code);
    const out = (stdout || "") + (stderr ? "\n" + stderr : "");
    setOutput(out.trim() ? out : "(no output)");
  }

  async function checkButton() {
    setCheck("Checking...");
    const ex = EXERCISES[currentIdx];
    const code = el("codeArea").value;

    const { stdout, stderr } = await runUserCode(code);
    if (stderr && stderr.trim().length > 0) {
      setOutput(((stdout||"") + "\n" + stderr).trim());
      setCheck("Fix the error first, then check again.", false);
      return;
    }

    // Test logic uses stdout only for these beginner tasks
    const testWrapper = `
stdout = ${JSON.stringify("")}
passed = False
msg = ""
# Inject captured stdout from the previous run:
stdout = captured_stdout
${ex.testPy}
`;
    pyodide.globals.set("captured_stdout", stdout);
    await pyodide.runPythonAsync(testWrapper);
    const passed = pyodide.globals.get("passed");
    const msg = pyodide.globals.get("msg");

    if (passed) {
      passedChecks += 1;
      el("kpiScore").textContent = `\u2713 Passed: ${passedChecks}`;
      setCheck("Correct!", true);
    } else {
      setCheck(msg || "Not correct yet.", false);
    }
  }

  async function initPyodide() {
    setStatus(`<span class="pill loading">\u2699 Loading Python...</span>`);
    setOutput("Loading Python runtime...");
    pyodide = await loadPyodide();
    setStatus(`<span class="pill active">\u2713 Ready</span> <span class="muted">Python in browser (Pyodide)</span>`);
    setOutput("Ready! Choose an exercise, load starter code, then click Run.");

    // Enable buttons
    el("btnRun").disabled = false;
    el("btnCheck").disabled = false;
    el("btnReset").disabled = false;
  }

  // MCQ
  const MCQ_ANSWERS = [
    { name: "q1", correct: "b", resultId: "mcqResult1",
      okMsg: "print() displays output to the screen.",
      badMsg: "print() displays output to the screen, it doesn't store values or create files." },
    { name: "q2", correct: "c", resultId: "mcqResult2",
      okMsg: "10 + 3 = 13.",
      badMsg: "x holds 10, so x + 3 equals 13." },
    { name: "q3", correct: "b", resultId: "mcqResult3",
      okMsg: "String concatenation joins the parts including the space.",
      badMsg: 'The + operator joins strings exactly as they are. "Hello" + " " + "World" gives "Hello World".' },
    { name: "q4", correct: "b", resultId: "mcqResult4",
      okMsg: "3 is not greater than 5, so the else branch runs.",
      badMsg: 'Since 3 > 5 is False, the else branch executes and prints "small".' },
    { name: "q5", correct: "b", resultId: "mcqResult5",
      okMsg: "range(3) gives 0, 1, 2.",
      badMsg: "In Python, range(3) gives 0, 1, 2 (starts at 0, stops before 3)." },
    { name: "q6", correct: "b", resultId: "mcqResult6",
      okMsg: "4 * 2 = 8.",
      badMsg: "double(4) returns 4 * 2, which is 8." },
  ];

  function checkMCQ() {
    let answered = 0;
    let correctCount = 0;
    MCQ_ANSWERS.forEach(q => {
      const picked = [...document.querySelectorAll(`input[name="${q.name}"]`)].find(r => r.checked)?.value;
      const resultEl = el(q.resultId);
      if (!picked) {
        resultEl.textContent = "";
        return;
      }
      answered++;
      if (picked === q.correct) {
        correctCount++;
        resultEl.innerHTML = `<span class="ok">Correct!</span> ${q.okMsg}`;
        resultEl.style.background = '#DCFCE7';
      } else {
        resultEl.innerHTML = `<span class="bad">Not quite.</span> ${q.badMsg}`;
        resultEl.style.background = '#FEE2E2';
      }
    });
    const mcqResultEl = el("mcqResult");
    if (answered === 0) {
      mcqResultEl.style.display = "block";
      mcqResultEl.textContent = "Select at least one option first.";
    } else {
      mcqResultEl.style.display = "block";
      mcqResultEl.innerHTML = `Score: ${correctCount}/${answered} answered correctly.`;
    }
  }

  // Wire up events
  populateExercises();
  loadExercise(0);

  el("exerciseSelect").addEventListener("change", (e) => loadExercise(Number(e.target.value)));
  el("btnLoad").addEventListener("click", () => { el("codeArea").value = EXERCISES[currentIdx].starter; setOutput(""); setCheck(""); });
  el("btnReveal").addEventListener("click", revealSolution);

  el("btnRun").addEventListener("click", runButton);
  el("btnCheck").addEventListener("click", checkButton);
  el("btnReset").addEventListener("click", resetToStarter);

  el("btnMCQ").addEventListener("click", checkMCQ);

  // Start
  initPyodide();
</script>
</body>
</html>
